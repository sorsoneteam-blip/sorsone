<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sorsone Admin Dashboard</title>
    <link rel="icon" type="image/jpeg" href="images/favicon.jpg">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 2rem;
        }

        .dashboard-container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .dashboard-header {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .dashboard-header h1 {
            font-size: 2rem;
            color: #2d3748;
        }

        .dashboard-header p {
            color: #718096;
            margin-top: 0.5rem;
        }

        .header-actions {
            display: flex;
            gap: 1rem;
        }

        .btn {
            padding: 0.8rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: white;
            color: #667eea;
            border: 2px solid #667eea;
        }

        .btn-secondary:hover {
            background: #667eea;
            color: white;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        .stat-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .stat-card-icon {
            width: 50px;
            height: 50px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        .stat-card-icon.orders {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .stat-card-icon.revenue {
            background: linear-gradient(135deg, #f093fb, #f5576c);
            color: white;
        }

        .stat-card-icon.customers {
            background: linear-gradient(135deg, #4facfe, #00f2fe);
            color: white;
        }

        .stat-card-icon.views {
            background: linear-gradient(135deg, #43e97b, #38f9d7);
            color: white;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: #2d3748;
        }

        .stat-label {
            color: #718096;
            font-size: 0.9rem;
            margin-top: 0.5rem;
        }

        .data-section {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .section-header h2 {
            font-size: 1.5rem;
            color: #2d3748;
        }

        .tabs {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            border-bottom: 2px solid #e2e8f0;
        }

        .tab {
            padding: 1rem 1.5rem;
            background: none;
            border: none;
            font-weight: 600;
            color: #718096;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
        }

        .tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }

        .table-container {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th {
            background: #f7fafc;
            padding: 1rem;
            text-align: left;
            font-weight: 600;
            color: #2d3748;
            border-bottom: 2px solid #e2e8f0;
        }

        td {
            padding: 1rem;
            border-bottom: 1px solid #e2e8f0;
            color: #4a5568;
        }

        tr:hover {
            background: #f7fafc;
        }

        .status-badge {
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .status-success {
            background: #c6f6d5;
            color: #22543d;
        }

        .status-pending {
            background: #feebc8;
            color: #7c2d12;
        }

        .status-failed {
            background: #fed7d7;
            color: #742a2a;
        }

        .loading {
            text-align: center;
            padding: 3rem;
            color: #718096;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .empty-state {
            text-align: center;
            padding: 3rem;
            color: #718096;
        }

        .empty-state i {
            font-size: 4rem;
            margin-bottom: 1rem;
            opacity: 0.3;
        }

        .config-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .config-modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            max-width: 500px;
            width: 90%;
        }

        .modal-content h3 {
            margin-bottom: 1.5rem;
            color: #2d3748;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #2d3748;
        }

        .form-group input {
            width: 100%;
            padding: 0.8rem;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1rem;
        }

        .form-group input:focus {
            outline: none;
            border-color: #667eea;
        }

        @media (max-width: 768px) {
            .dashboard-header {
                flex-direction: column;
                gap: 1rem;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .tabs {
                flex-wrap: wrap;
            }

            table {
                font-size: 0.85rem;
            }
        }
    </style>
</head>
<body>
    <!-- Configuration Modal -->
    <div class="config-modal" id="configModal">
        <div class="modal-content">
            <h3><i class="fas fa-cog"></i> Configure Backend URL</h3>
            <div class="form-group">
                <label>Google Apps Script Web App URL:</label>
                <input type="text" id="backendUrlInput" placeholder="https://script.google.com/macros/s/...">
            </div>
            <div class="header-actions">
                <button class="btn btn-primary" onclick="saveBackendUrl()">
                    <i class="fas fa-save"></i> Save
                </button>
                <button class="btn btn-secondary" onclick="closeConfigModal()">
                    Cancel
                </button>
            </div>
        </div>
    </div>

    <div class="dashboard-container">
        <!-- Header -->
        <div class="dashboard-header">
            <div>
                <h1><i class="fas fa-chart-line"></i> Sorsone Admin Dashboard</h1>
                <p>Real-time data from Google Sheets</p>
            </div>
            <div class="header-actions">
                <button class="btn btn-primary" onclick="refreshData()">
                    <i class="fas fa-sync-alt"></i> Refresh Data
                </button>
                <button class="btn btn-secondary" onclick="showConfigModal()">
                    <i class="fas fa-cog"></i> Configure
                </button>
            </div>
        </div>

        <!-- Stats Grid -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-card-header">
                    <div>
                        <div class="stat-value" id="totalOrders">-</div>
                        <div class="stat-label">Total Orders</div>
                    </div>
                    <div class="stat-card-icon orders">
                        <i class="fas fa-shopping-cart"></i>
                    </div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-card-header">
                    <div>
                        <div class="stat-value" id="totalRevenue">₹-</div>
                        <div class="stat-label">Total Revenue</div>
                    </div>
                    <div class="stat-card-icon revenue">
                        <i class="fas fa-rupee-sign"></i>
                    </div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-card-header">
                    <div>
                        <div class="stat-value" id="totalCustomers">-</div>
                        <div class="stat-label">Total Customers</div>
                    </div>
                    <div class="stat-card-icon customers">
                        <i class="fas fa-users"></i>
                    </div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-card-header">
                    <div>
                        <div class="stat-value" id="pageViews">-</div>
                        <div class="stat-label">Page Views</div>
                    </div>
                    <div class="stat-card-icon views">
                        <i class="fas fa-eye"></i>
                    </div>
                </div>
            </div>
        </div>

        <!-- Data Section -->
        <div class="data-section">
            <div class="section-header">
                <h2>Data Overview</h2>
            </div>
            
            <div class="tabs">
                <button class="tab active" onclick="switchTab('customers')">
                    <i class="fas fa-users"></i> Customers
                </button>
                <button class="tab" onclick="switchTab('payments')">
                    <i class="fas fa-credit-card"></i> Payments
                </button>
                <button class="tab" onclick="switchTab('analytics')">
                    <i class="fas fa-chart-bar"></i> Analytics
                </button>
            </div>

            <!-- Customers Tab -->
            <div class="tab-content" id="customersTab">
                <div class="table-container">
                    <table id="customersTable">
                        <thead>
                            <tr>
                                <th>Order ID</th>
                                <th>Customer Name</th>
                                <th>Email</th>
                                <th>Phone</th>
                                <th>Location</th>
                                <th>Items</th>
                                <th>Amount</th>
                                <th>Date & Time</th>
                            </tr>
                        </thead>
                        <tbody id="customersBody">
                            <tr>
                                <td colspan="8" class="loading">
                                    <div class="spinner"></div>
                                    Loading customers...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Payments Tab -->
            <div class="tab-content" id="paymentsTab" style="display: none;">
                <div class="table-container">
                    <table id="paymentsTable">
                        <thead>
                            <tr>
                                <th>Payment ID</th>
                                <th>Order ID</th>
                                <th>Razorpay ID</th>
                                <th>Amount</th>
                                <th>Status</th>
                                <th>Method</th>
                                <th>Email</th>
                                <th>Date & Time</th>
                            </tr>
                        </thead>
                        <tbody id="paymentsBody">
                            <tr>
                                <td colspan="8" class="loading">
                                    <div class="spinner"></div>
                                    Loading payments...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Analytics Tab -->
            <div class="tab-content" id="analyticsTab" style="display: none;">
                <div class="table-container">
                    <table id="analyticsTable">
                        <thead>
                            <tr>
                                <th>Date & Time</th>
                                <th>Page URL</th>
                                <th>Views</th>
                                <th>Device Type</th>
                                <th>Browser</th>
                                <th>Referrer</th>
                            </tr>
                        </thead>
                        <tbody id="analyticsBody">
                            <tr>
                                <td colspan="6" class="loading">
                                    <div class="spinner"></div>
                                    Loading analytics...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentTab = 'customers';
        let customersData = [];
        let paymentsData = [];
        let analyticsData = [];

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            const backendUrl = localStorage.getItem('sorsoneBackendUrl');
            if (!backendUrl) {
                showConfigModal();
            } else {
                refreshData();
            }
        });

        function showConfigModal() {
            const modal = document.getElementById('configModal');
            const input = document.getElementById('backendUrlInput');
            input.value = localStorage.getItem('sorsoneBackendUrl') || '';
            modal.classList.add('active');
        }

        function closeConfigModal() {
            document.getElementById('configModal').classList.remove('active');
        }

        function saveBackendUrl() {
            const url = document.getElementById('backendUrlInput').value.trim();
            if (!url) {
                alert('Please enter a valid URL');
                return;
            }
            localStorage.setItem('sorsoneBackendUrl', url);
            closeConfigModal();
            refreshData();
        }

        async function refreshData() {
            const backendUrl = localStorage.getItem('sorsoneBackendUrl');
            if (!backendUrl) {
                alert('Please configure the backend URL first');
                showConfigModal();
                return;
            }

            try {
                // Fetch all data
                const [customersResponse, paymentsResponse, analyticsResponse] = await Promise.all([
                    fetch(`${backendUrl}?action=get_customers`),
                    fetch(`${backendUrl}?action=get_payments`),
                    fetch(`${backendUrl}?action=get_analytics`)
                ]);

                const customersResult = await customersResponse.json();
                const paymentsResult = await paymentsResponse.json();
                const analyticsResult = await analyticsResponse.json();

                if (customersResult.success) customersData = customersResult.data;
                if (paymentsResult.success) paymentsData = paymentsResult.data;
                if (analyticsResult.success) analyticsData = analyticsResult.data;

                updateStats();
                renderCurrentTab();

            } catch (error) {
                console.error('Error fetching data:', error);
                alert('Error fetching data. Please check your backend URL and try again.');
            }
        }

        function updateStats() {
            // Total Orders
            document.getElementById('totalOrders').textContent = customersData.length;

            // Total Revenue
            const totalRevenue = customersData.reduce((sum, customer) => sum + (parseFloat(customer.totalAmount) || 0), 0);
            document.getElementById('totalRevenue').textContent = '₹' + totalRevenue.toLocaleString('en-IN');

            // Total Customers (unique emails)
            const uniqueEmails = new Set(customersData.map(c => c.email));
            document.getElementById('totalCustomers').textContent = uniqueEmails.size;

            // Page Views
            const totalViews = analyticsData.reduce((sum, analytic) => sum + (parseInt(analytic.pageViews) || 0), 0);
            document.getElementById('pageViews').textContent = totalViews.toLocaleString('en-IN');
        }

        function switchTab(tab) {
            currentTab = tab;
            
            // Update tab buttons
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            event.target.closest('.tab').classList.add('active');

            // Show/hide content
            document.getElementById('customersTab').style.display = tab === 'customers' ? 'block' : 'none';
            document.getElementById('paymentsTab').style.display = tab === 'payments' ? 'block' : 'none';
            document.getElementById('analyticsTab').style.display = tab === 'analytics' ? 'block' : 'none';

            renderCurrentTab();
        }

        function renderCurrentTab() {
            if (currentTab === 'customers') {
                renderCustomers();
            } else if (currentTab === 'payments') {
                renderPayments();
            } else if (currentTab === 'analytics') {
                renderAnalytics();
            }
        }

        function renderCustomers() {
            const tbody = document.getElementById('customersBody');
            
            if (customersData.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="8" class="empty-state">
                            <i class="fas fa-inbox"></i>
                            <p>No customer data available</p>
                        </td>
                    </tr>
                `;
                return;
            }

            tbody.innerHTML = customersData.map(customer => `
                <tr>
                    <td><strong>${customer.orderId}</strong></td>
                    <td>${customer.fullName}</td>
                    <td>${customer.email}</td>
                    <td>${customer.phone}</td>
                    <td>${customer.city}, ${customer.state}</td>
                    <td>${customer.totalItems}</td>
                    <td><strong>₹${parseFloat(customer.totalAmount).toLocaleString('en-IN')}</strong></td>
                    <td>${customer.orderDateTime}</td>
                </tr>
            `).join('');
        }

        function renderPayments() {
            const tbody = document.getElementById('paymentsBody');
            
            if (paymentsData.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="8" class="empty-state">
                            <i class="fas fa-inbox"></i>
                            <p>No payment data available</p>
                        </td>
                    </tr>
                `;
                return;
            }

            tbody.innerHTML = paymentsData.map(payment => {
                const statusClass = payment.status === 'success' ? 'status-success' : 
                                   payment.status === 'pending' ? 'status-pending' : 'status-failed';
                
                return `
                    <tr>
                        <td><strong>${payment.paymentId}</strong></td>
                        <td>${payment.orderId}</td>
                        <td><code>${payment.razorpayPaymentId}</code></td>
                        <td><strong>₹${parseFloat(payment.amount).toLocaleString('en-IN')}</strong></td>
                        <td><span class="status-badge ${statusClass}">${payment.status}</span></td>
                        <td>${payment.method}</td>
                        <td>${payment.email}</td>
                        <td>${payment.paymentDateTime}</td>
                    </tr>
                `;
            }).join('');
        }

        function renderAnalytics() {
            const tbody = document.getElementById('analyticsBody');
            
            if (analyticsData.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" class="empty-state">
                            <i class="fas fa-inbox"></i>
                            <p>No analytics data available</p>
                        </td>
                    </tr>
                `;
                return;
            }

            tbody.innerHTML = analyticsData.map(analytic => `
                <tr>
                    <td>${analytic.dateTime}</td>
                    <td><code>${analytic.pageUrl}</code></td>
                    <td>${analytic.pageViews}</td>
                    <td>${analytic.deviceType}</td>
                    <td>${analytic.browser}</td>
                    <td>${analytic.referrer}</td>
                </tr>
            `).join('');
        }
    </script>
</body>
</html>
